<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>音效文件名翻译重命名 | Eagle插件</title>
    <link rel="stylesheet" href="./assets/css/main.css">
    <link rel="stylesheet" href="./assets/css/matching-strategy-panel.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

    <!-- NLP库 (本地文件) -->
    <script src="./assets/js/libs/compromise.js"></script>
    <!-- 中文分词和词性分析库 -->
    <script src="https://cdn.jsdelivr.net/npm/segmentit@2.0.3/dist/umd/segmentit.min.js"></script>
    <script src="./assets/js/libs/segmentit-direct.js"></script>
    <!-- Intl.Segmenter适配器 -->
    <script src="./assets/js/libs/intl-segmenter-adapter.js"></script>

</head>
<body>
    <!-- 插件加载状态提示 -->
    <div id="loadingIndicator" style="position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(255,255,255,0.9);display:flex;flex-direction:column;justify-content:center;align-items:center;z-index:9999;">
        <div style="width:50px;height:50px;border:5px solid #f3f3f3;border-top:5px solid #3498db;border-radius:50%;animation:spin 1s linear infinite;"></div>
        <p style="margin-top:20px;font-size:16px;">正在加载插件...</p>
        <p id="loadingStatus" style="margin-top:10px;font-size:14px;color:#666;"></p>
        <div id="loadingError" style="display:none;margin-top:20px;padding:15px;background:#f8d7da;color:#721c24;border-radius:4px;max-width:80%;text-align:center;">
            <p style="margin:0 0 10px 0;font-weight:bold;">插件加载失败</p>
            <p id="errorMessage" style="margin:0 0 10px 0;">请刷新页面或重启 Eagle 后重试。</p>
            <button onclick="location.reload()" style="padding:5px 15px;background:#dc3545;color:white;border:none;border-radius:4px;cursor:pointer;">刷新页面</button>
        </div>
    </div>

    <style>
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* 状态样式 */
        .status-available {
            color: #28a745;
            font-weight: bold;
            padding: 5px 10px;
            border-radius: 4px;
            background-color: rgba(40, 167, 69, 0.1);
            display: inline-block;
            margin: 5px 0;
        }

        .status-disabled {
            color: #6c757d;
            font-weight: bold;
            padding: 5px 10px;
            border-radius: 4px;
            background-color: rgba(108, 117, 125, 0.1);
            display: inline-block;
            margin: 5px 0;
        }

        .status-error {
            color: #dc3545;
            font-weight: bold;
            padding: 5px 10px;
            border-radius: 4px;
            background-color: rgba(220, 53, 69, 0.1);
            display: inline-block;
            margin: 5px 0;
        }

        .status-pending {
            color: #ffc107;
            font-weight: bold;
            padding: 5px 10px;
            border-radius: 4px;
            background-color: rgba(255, 193, 7, 0.1);
            display: inline-block;
            margin: 5px 0;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { opacity: 0.6; }
            50% { opacity: 1; }
            100% { opacity: 0.6; }
        }

        /* 验证结果样式 */
        .validation-success {
            color: #28a745;
            font-weight: bold;
            padding: 5px 10px;
            border-radius: 4px;
            background-color: rgba(40, 167, 69, 0.1);
            display: inline-block;
        }

        .validation-error {
            color: #dc3545;
            font-weight: bold;
            padding: 5px 10px;
            border-radius: 4px;
            background-color: rgba(220, 53, 69, 0.1);
            display: inline-block;
        }

        .validation-pending {
            color: #ffc107;
            font-weight: bold;
            padding: 5px 10px;
            border-radius: 4px;
            background-color: rgba(255, 193, 7, 0.1);
            display: inline-block;
            animation: pulse 1.5s infinite;
        }

        /* 本地分词系统样式 */
        .local-tokenizer-status {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border: 1px solid #dee2e6;
            border-radius: 12px;
            padding: 20px;
            margin-top: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .status-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 15px 0;
        }

        .status-item {
            display: flex;
            align-items: center;
            background: white;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid #e9ecef;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .status-icon {
            font-size: 20px;
            margin-right: 12px;
        }

        .status-ready {
            color: #28a745;
        }

        .status-content {
            display: flex;
            flex-direction: column;
        }

        .status-label {
            font-weight: 600;
            color: #495057;
            font-size: 14px;
        }

        .status-detail {
            font-size: 12px;
            color: #6c757d;
            margin-top: 2px;
        }

        .feature-highlights {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #dee2e6;
        }

        .feature-highlights h5 {
            color: #495057;
            margin-bottom: 12px;
            font-size: 14px;
        }

        .feature-list {
            list-style: none;
            padding: 0;
            margin: 0;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }

        .feature-list li {
            display: flex;
            align-items: center;
            font-size: 13px;
            color: #495057;
        }

        .feature-list li i {
            color: #28a745;
            margin-right: 8px;
            width: 16px;
        }
    </style>

    <div id="app" style="display:none;">
        <header class="app-header">
            <h1><i class="fas fa-language"></i> 音效文件名翻译重命名</h1>
            <p class="app-subtitle">智能翻译并格式化音效文件名称</p>
            <div id="plugin-info" class="plugin-info"></div>
            <button id="themeToggle" class="theme-toggle">
                <i class="fas fa-moon"></i>
            </button>
        </header>

        <main class="app-content">
            <!-- 工作流程指引 -->
            <section class="workflow-guide">
                <div class="workflow-step active">
                    <div class="step-number">1</div>
                    <div class="step-label">选择文件</div>
                </div>
                <div class="workflow-divider"></div>
                <div class="workflow-step">
                    <div class="step-number">2</div>
                    <div class="step-label">设置翻译</div>
                </div>
                <div class="workflow-divider"></div>
                <div class="workflow-step">
                    <div class="step-number">3</div>
                    <div class="step-label">命名规则</div>
                </div>
                <div class="workflow-divider"></div>
                <div class="workflow-step">
                    <div class="step-number">4</div>
                    <div class="step-label">预览结果</div>
                </div>
            </section>

            <!-- 主要内容容器 -->
            <div class="main-container">
                <!-- 文件选择区域 -->
                <section id="fileSelector" class="section">
                    <h2><i class="fas fa-file-audio"></i> 选择音效文件</h2>

                    <div class="file-selection-methods">
                        <button id="selectFromCurrent" class="btn">
                            <i class="fas fa-mouse-pointer"></i> 当前选中
                        </button>
                        <button id="selectFromTag" class="btn">
                            <i class="fas fa-tags"></i> 从标签
                        </button>
                    </div>

                    <div class="selected-files-info">
                        已选择 <span id="selectedCount">0</span> 个文件
                    </div>

                    <div id="selectedFilesList" class="selected-files-list"></div>

                    <!-- 文件夹树选择器 -->
                    <div class="folder-tree-section">
                        <h3><i class="fas fa-sitemap"></i> 文件夹树选择</h3>
                        <div class="folder-tree-inline">
                            <div class="folder-tree-controls">
                                <div class="folder-tree-search">
                                    <input type="text" id="folderTreeSearch" placeholder="搜索文件夹..." class="search-input">
                                    <i class="fas fa-search search-icon"></i>
                                </div>
                                <div class="folder-tree-options">
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="includeSubfolders" checked>
                                        <span class="checkmark"></span>
                                        包含子文件夹中的文件
                                    </label>
                                </div>
                            </div>
                            <div class="folder-tree-content">
                                <div class="folder-tree-list" id="folderTreeList">
                                    <div class="loading-message">
                                        <i class="fas fa-spinner fa-spin"></i> 正在加载文件夹...
                                    </div>
                                </div>
                            </div>
                            <div class="folder-tree-status">
                                <div class="selected-folder-info">
                                    <span id="selectedFolderName">未选择文件夹</span>
                                    <span id="selectedFolderCount" class="folder-count"></span>
                                </div>
                                <button id="confirmFolderSelection" class="btn btn-primary" disabled>
                                    <i class="fas fa-check"></i> 选择此文件夹
                                </button>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- 翻译设置区域 -->
                <section id="translationSettings" class="section">
                    <h2><i class="fas fa-cog"></i> 翻译设置</h2>

                    <ul class="nav nav-tabs">
                        <li class="active"><a href="#translationTab" data-toggle="tab">翻译设置</a></li>
                        <li><a href="#aiTab" data-toggle="tab">AI模型设置</a></li>
                        <li><a href="#aliyunTab" data-toggle="tab">本地分词</a></li>
                    </ul>

                    <div class="tab-content">
                        <div id="translationTab" class="tab-pane active">
                            <div class="settings-group">
                                <div class="setting-item">
                                    <label for="sourceLanguage"><i class="fas fa-globe-americas"></i> 源语言：</label>
                                    <select id="sourceLanguage" class="select-with-icon">
                                        <option value="auto">自动检测</option>
                                        <option value="en" selected>英语 (English)</option>
                                        <option value="ja">日语 (日本語)</option>
                                        <option value="ko">韩语 (한국어)</option>
                                    </select>
                                </div>
                                <div class="setting-item">
                                    <label for="targetLanguage"><i class="fas fa-globe-asia"></i> 目标语言：</label>
                                    <select id="targetLanguage" class="select-with-icon">
                                        <option value="zh-CN" selected>中文(简体)</option>
                                        <option value="zh-TW">中文(繁体)</option>
                                        <option value="en">英语 (English)</option>
                                    </select>
                                </div>
                                <div class="setting-toggle">
                                    <label class="toggle">
                                        <input type="checkbox" id="standardizeEnglish">
                                        <span class="toggle-slider"></span>
                                        <span class="toggle-label"><i class="fas fa-robot"></i> 对英文进行标准化处理</span>
                                    </label>
                                </div>

                                <div id="namingStyleContainer" class="settings-group" style="display:none;">
                                    <div class="setting-item">
                                        <label for="namingStyle"><i class="fas fa-font"></i> 命名风格：</label>
                                        <select id="namingStyle">
                                            <option value="none">不处理</option>
                                            <option value="camelCase">驼峰命名 (camelCase)</option>
                                            <option value="PascalCase">帕斯卡命名 (PascalCase)</option>
                                            <option value="snake_case">蛇形命名 (snake_case)</option>
                                            <option value="kebab-case">烧烤命名 (kebab-case)</option>
                                            <option value="custom">自定义分隔符</option>
                                        </select>
                                    </div>

                                    <div id="customSeparatorContainer" class="setting-item" style="display:none;">
                                        <label for="customSeparator"><i class="fas fa-minus"></i> 自定义分隔符：</label>
                                        <input type="text" id="customSeparator" value="_" maxlength="1">
                                    </div>
                                </div>
                            </div>

                            <div class="settings-options">
                                <div class="setting-toggle">
                                    <label class="toggle">
                                        <input type="checkbox" id="useCache" checked>
                                        <span class="toggle-slider"></span>
                                        <span class="toggle-label"><i class="fas fa-database"></i> 启用翻译缓存</span>
                                    </label>
                                </div>
                                <div class="setting-toggle">
                                    <label class="toggle">
                                        <input type="checkbox" id="useCSV" checked>
                                        <span class="toggle-slider"></span>
                                        <span class="toggle-label"><i class="fas fa-table"></i> 使用CSV术语库</span>
                                    </label>
                                </div>
                                <div class="setting-toggle">
                                    <label class="toggle">
                                        <input type="checkbox" id="useAIClassification">
                                        <span class="toggle-slider"></span>
                                        <span class="toggle-label"><i class="fas fa-robot"></i> 使用AI辅助分类匹配</span>
                                    </label>
                                    <div class="setting-description">
                                        <small>使用AI接口获取音效分类信息，提高匹配准确性（需要额外API请求）</small>
                                    </div>
                                </div>

                                <div class="setting-item">
                                    <label for="matchStrategy"><i class="fas fa-sitemap"></i> 匹配策略：</label>
                                    <select id="matchStrategy">
                                        <option value="auto">自动（按优先级）</option>
                                        <option value="ai">AI辅助分类（如果启用）</option>
                                        <option value="bilingual">双语匹配（中英文结合）</option>
                                        <option value="pos">基于词性系统的匹配</option>
                                        <option value="translated">翻译文本直接匹配</option>
                                    </select>
                                    <div class="setting-description">
                                        <small>选择匹配策略会影响分类结果的准确性，自动模式会按优先级尝试所有5种策略（AI分类自动启用）</small>
                                    </div>
                                </div>


                            </div>
                        </div>

                        <div id="aiTab" class="tab-pane">
                            <div class="settings-group">
                                <div class="setting-item">
                                    <label for="translationProvider"><i class="fas fa-server"></i> 翻译服务：</label>
                                    <select id="translationProvider" class="select-with-icon">
                                        <option value="zhipu">智谱AI</option>
                                        <option value="deepseek">Deepseek</option>
                                        <option value="openrouter">OpenRouter AI</option>
                                        <option value="bailian">阿里云百炼</option>
                                        <option value="google">Google 翻译</option>
                                    </select>
                                </div>

                                <!-- 字符限制设置 -->
                                <div class="setting-group">
                                    <h4><i class="fas fa-text-width"></i> 翻译字符限制</h4>
                                    <div class="setting-description">
                                        <small>设置翻译结果的最大字符数，用于控制翻译结果的长度</small>
                                    </div>

                                    <div class="setting-item">
                                        <label for="charLimitEn"><i class="fas fa-font"></i> 英文字符限制：</label>
                                        <input type="number" id="charLimitEn" min="1" max="100" value="30" style="width: 80px;">
                                        <small>字符</small>
                                    </div>

                                    <div class="setting-item">
                                        <label for="charLimitZh"><i class="fas fa-font"></i> 中文字符限制：</label>
                                        <input type="number" id="charLimitZh" min="1" max="50" value="7" style="width: 80px;">
                                        <small>字</small>
                                    </div>
                                </div>
                            </div>

                            <div id="zhipuSettings" class="api-settings">
                                <div class="setting-item">
                                    <label for="zhipuKey"><i class="fas fa-key"></i> API密钥：</label>
                                    <div class="input-with-link">
                                        <input type="text" id="zhipuKey" placeholder="输入智谱AI API密钥">
                                        <a href="https://open.bigmodel.cn/usercenter/apikeys" target="_blank" class="input-link">获取密钥</a>
                                    </div>
                                </div>

                                <div class="setting-item">
                                    <label for="zhipuModel"><i class="fas fa-brain"></i> 模型：</label>
                                    <select id="zhipuModel">
                                        <option value="glm-4">GLM-4</option>
                                        <option value="glm-3-turbo">GLM-3-Turbo</option>
                                        <option value="chatglm_turbo">ChatGLM Turbo</option>
                                    </select>
                                </div>

                                <div class="setting-item">
                                    <label for="zhipuPromptID"><i class="fas fa-comment-alt"></i> 提示风格：</label>
                                    <select id="zhipuPromptID" class="customPromptID">
                                        <option value="">默认</option>
                                        <option value="accurate">准确专业</option>
                                        <option value="natural">自然流畅</option>
                                        <option value="creative">创意生动</option>
                                        <option value="audio">音效专用</option>
                                        <option value="custom">自定义提示</option>
                                    </select>
                                    <button id="zhipuViewPromptBtn" class="btn btn-sm btn-info viewPromptBtn" style="margin-left: 10px;">
                                        <i class="fas fa-eye"></i> 查看提示词
                                    </button>
                                </div>

                                <div id="zhipuCustomPromptContainer" class="setting-item customPromptContainer" style="display:none;">
                                    <label for="zhipuPromptTemplate"><i class="fas fa-edit"></i> 自定义提示模板：</label>
                                    <textarea id="zhipuPromptTemplate" class="promptTemplate" rows="3" placeholder="使用{text}表示原文本，{from}表示源语言，{to}表示目标语言"></textarea>
                                    <small class="form-text">提示：使用{text}、{from}和{to}作为变量占位符</small>
                                </div>
                            </div>

                            <div id="deepseekSettings" class="api-settings" style="display:none;">
                                <div class="setting-item">
                                    <label for="deepseekKey"><i class="fas fa-key"></i> API密钥：</label>
                                    <div class="input-with-link">
                                        <input type="text" id="deepseekKey" placeholder="输入Deepseek API密钥">
                                        <a href="https://platform.deepseek.com/api-keys" target="_blank" class="input-link">获取密钥</a>
                                    </div>
                                </div>

                                <div class="setting-item">
                                    <label for="deepseekModel"><i class="fas fa-brain"></i> 模型：</label>
                                    <select id="deepseekModel">
                                        <option value="deepseek-chat">Deepseek Chat</option>
                                    </select>
                                </div>

                                <div class="setting-item">
                                    <label for="deepseekPromptID"><i class="fas fa-comment-alt"></i> 提示风格：</label>
                                    <select id="deepseekPromptID" class="customPromptID">
                                        <option value="">默认</option>
                                        <option value="accurate">准确专业</option>
                                        <option value="natural">自然流畅</option>
                                        <option value="creative">创意生动</option>
                                        <option value="audio">音效专用</option>
                                        <option value="custom">自定义提示</option>
                                    </select>
                                    <button id="deepseekViewPromptBtn" class="btn btn-sm btn-info viewPromptBtn" style="margin-left: 10px;">
                                        <i class="fas fa-eye"></i> 查看提示词
                                    </button>
                                </div>

                                <div id="deepseekCustomPromptContainer" class="setting-item customPromptContainer" style="display:none;">
                                    <label for="deepseekPromptTemplate"><i class="fas fa-edit"></i> 自定义提示模板：</label>
                                    <textarea id="deepseekPromptTemplate" class="promptTemplate" rows="3" placeholder="使用{text}表示原文本，{from}表示源语言，{to}表示目标语言"></textarea>
                                    <small class="form-text">提示：使用{text}、{from}和{to}作为变量占位符</small>
                                </div>
                            </div>

                            <div id="openrouterSettings" class="api-settings" style="display:none;">
                                <div class="setting-item">
                                    <label for="openrouterKey"><i class="fas fa-key"></i> API密钥：</label>
                                    <div class="input-with-link">
                                        <input type="text" id="openrouterKey" placeholder="sk-or-v1-...">
                                        <a href="https://openrouter.ai/keys" target="_blank" class="input-link">获取密钥</a>
                                    </div>
                                </div>

                                <div class="setting-item">
                                    <label for="aiModel"><i class="fas fa-brain"></i> AI模型：</label>
                                    <select id="aiModel">
                                        <option value="deepseek-chat-v3">Deepseek Chat V3 (免费)</option>
                                        <option value="gemini-flash">Gemini 2.0 Flash (免费)</option>
                                        <option value="qwen-32b">Qwen 32B (免费)</option>
                                        <option value="custom">自定义模型</option>
                                    </select>
                                </div>

                                <div id="customModelContainer" class="setting-item" style="display:none;">
                                    <label for="customModelId"><i class="fas fa-code"></i> 自定义模型ID：</label>
                                    <input type="text" id="customModelId" placeholder="例如: anthropic/claude-3-opus">
                                </div>

                                <div class="setting-item">
                                    <label for="openrouterPromptID"><i class="fas fa-comment-alt"></i> 提示风格：</label>
                                    <select id="openrouterPromptID" class="customPromptID">
                                        <option value="">默认</option>
                                        <option value="accurate">准确专业</option>
                                        <option value="natural">自然流畅</option>
                                        <option value="creative">创意生动</option>
                                        <option value="audio">音效专用</option>
                                        <option value="custom">自定义提示</option>
                                    </select>
                                    <button id="openrouterViewPromptBtn" class="btn btn-sm btn-info viewPromptBtn" style="margin-left: 10px;">
                                        <i class="fas fa-eye"></i> 查看提示词
                                    </button>
                                </div>

                                <div id="openrouterCustomPromptContainer" class="setting-item customPromptContainer" style="display:none;">
                                    <label for="openrouterPromptTemplate"><i class="fas fa-edit"></i> 自定义提示模板：</label>
                                    <textarea id="openrouterPromptTemplate" class="promptTemplate" rows="3" placeholder="使用{text}表示原文本，{from}表示源语言，{to}表示目标语言"></textarea>
                                    <small class="form-text">提示：使用{text}、{from}和{to}作为变量占位符</small>
                                </div>
                            </div>

                            <div id="googleSettings" class="api-settings" style="display:none;">
                                <p class="settings-note">使用Google翻译无需额外设置。</p>
                            </div>



                            <div id="bailianSettings" class="api-settings" style="display:none;">
                                <div class="setting-item">
                                    <label for="bailianKey"><i class="fas fa-key"></i> API密钥：</label>
                                    <div class="input-with-link">
                                        <input type="text" id="bailianKey" placeholder="输入阿里云百炼API密钥">
                                        <a href="https://bailian.console.aliyun.com/api-keys" target="_blank" class="input-link">获取密钥</a>
                                    </div>
                                </div>

                                <div class="setting-item">
                                    <label for="bailianModel"><i class="fas fa-brain"></i> 模型：</label>
                                    <select id="bailianModel">
                                        <option value="qwen-max">通义千问Max</option>
                                        <option value="qwen-plus">通义千问Plus</option>
                                        <option value="qwen-turbo">通义千问Turbo</option>
                                        <option value="qwen-vl-max">通义千问VL Max</option>
                                        <option value="qwen-vl-plus">通义千问VL Plus</option>
                                    </select>
                                </div>

                                <div class="setting-item">
                                    <label for="bailianPromptID"><i class="fas fa-comment-alt"></i> 提示风格：</label>
                                    <select id="bailianPromptID" class="customPromptID">
                                        <option value="">默认</option>
                                        <option value="accurate">准确专业</option>
                                        <option value="natural">自然流畅</option>
                                        <option value="creative">创意生动</option>
                                        <option value="audio">音效专用</option>
                                        <option value="custom">自定义提示</option>
                                    </select>
                                    <button id="bailianViewPromptBtn" class="btn btn-sm btn-info viewPromptBtn" style="margin-left: 10px;">
                                        <i class="fas fa-eye"></i> 查看提示词
                                    </button>
                                </div>

                                <div id="bailianCustomPromptContainer" class="setting-item customPromptContainer" style="display:none;">
                                    <label for="bailianPromptTemplate"><i class="fas fa-edit"></i> 自定义提示模板：</label>
                                    <textarea id="bailianPromptTemplate" class="promptTemplate" rows="3" placeholder="使用{text}表示原文本，{from}表示源语言，{to}表示目标语言"></textarea>
                                    <small class="form-text">提示：使用{text}、{from}和{to}作为变量占位符</small>
                                </div>
                            </div>
                        </div>

                        <!-- 本地分词与匹配设置 -->
                        <div id="aliyunTab" class="tab-pane">
                            <div class="settings-group">
                                <div class="setting-description">
                                    <h4><i class="fas fa-microchip"></i> 本地分词系统</h4>
                                    <p>插件使用本地分词系统进行文本处理，无需额外配置：</p>
                                    <ul>
                                        <li><strong>中文分词</strong>：使用 Segmentit 库进行中文分词和词性分析</li>
                                        <li><strong>英文分词</strong>：使用 Compromise.js 库进行英文词性分析</li>
                                        <li><strong>优势</strong>：无需网络连接，响应速度快，完全免费</li>
                                    </ul>
                                </div>





                                    <div class="setting-group">
                                        <h4><i class="fas fa-filter"></i> 词性过滤设置</h4>
                                        <div class="setting-description">
                                            <small>设置词性分析结果的过滤规则，可以提高匹配准确性</small>
                                        </div>

                                        <div class="setting-toggle">
                                            <label class="toggle">
                                                <input type="checkbox" id="enablePosFilter" checked>
                                                <span class="toggle-slider"></span>
                                                <span class="toggle-label"><i class="fas fa-filter"></i> 启用词性过滤</span>
                                            </label>
                                            <div class="setting-description">
                                                <small>过滤低权重的标点符号、数字和功能词，提高匹配准确性</small>
                                            </div>
                                        </div>

                                        <div class="setting-toggle">
                                            <label class="toggle">
                                                <input type="checkbox" id="filterPunctuation" checked>
                                                <span class="toggle-slider"></span>
                                                <span class="toggle-label"><i class="fas fa-minus"></i> 过滤标点符号</span>
                                            </label>
                                            <div class="setting-description">
                                                <small>过滤下划线、连字符等标点符号，减少干扰</small>
                                            </div>
                                        </div>

                                        <div class="setting-toggle">
                                            <label class="toggle">
                                                <input type="checkbox" id="filterNumbers" checked>
                                                <span class="toggle-slider"></span>
                                                <span class="toggle-label"><i class="fas fa-sort-numeric-down"></i> 过滤单独数字</span>
                                            </label>
                                            <div class="setting-description">
                                                <small>过滤单独的数字，如"1"、"2"等，保留与文字组合的数字</small>
                                            </div>
                                        </div>

                                        <div class="setting-toggle">
                                            <label class="toggle">
                                                <input type="checkbox" id="filterFunctionWords" checked>
                                                <span class="toggle-slider"></span>
                                                <span class="toggle-label"><i class="fas fa-font"></i> 过滤功能词</span>
                                            </label>
                                            <div class="setting-description">
                                                <small>过滤"的"、"了"、"the"、"of"等功能词，提高匹配精度</small>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- 匹配策略配置面板 -->
                                    <div class="setting-group">
                                        <h4><i class="fas fa-cogs"></i> 匹配策略配置</h4>
                                        <div class="setting-description">
                                            <small>配置不同匹配方式的启用状态和优先级，自定义匹配流程</small>
                                        </div>

                                        <div id="matchingStrategyContainer" class="matching-strategy-container">
                                            <!-- 匹配策略配置面板将在这里动态添加 -->
                                            <div class="placeholder-message">
                                                <i class="fas fa-cog fa-spin"></i>
                                                <p>加载匹配策略配置...</p>
                                            </div>
                                        </div>
                                    </div>

                                <div class="local-tokenizer-status">
                                    <h4><i class="fas fa-info-circle"></i> 分词系统状态</h4>
                                    <div class="status-grid">
                                        <div class="status-item">
                                            <i class="fas fa-check-circle status-icon status-ready"></i>
                                            <div class="status-content">
                                                <span class="status-label">中文分词</span>
                                                <span class="status-detail">Segmentit + Intl.Segmenter</span>
                                            </div>
                                        </div>
                                        <div class="status-item">
                                            <i class="fas fa-check-circle status-icon status-ready"></i>
                                            <div class="status-content">
                                                <span class="status-label">英文分词</span>
                                                <span class="status-detail">Compromise.js</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="feature-highlights">
                                        <h5><i class="fas fa-star"></i> 系统优势</h5>
                                        <ul class="feature-list">
                                            <li><i class="fas fa-bolt"></i> 本地处理，响应速度快</li>
                                            <li><i class="fas fa-shield-alt"></i> 完全离线，保护隐私</li>
                                            <li><i class="fas fa-gift"></i> 完全免费，无使用限制</li>
                                            <li><i class="fas fa-wifi"></i> 无需网络连接</li>
                                        </ul>
                                    </div>
                                </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- 命名规则设置 -->
                <section id="namingRules" class="section">
                    <h2><i class="fas fa-font"></i> 命名规则设置</h2>

                    <div class="setting-toggle">
                        <label class="toggle">
                            <input type="checkbox" id="useUCSNaming" checked>
                            <span class="toggle-slider"></span>
                            <span class="toggle-label"><i class="fas fa-sitemap"></i> 使用UCS回路式命名规则</span>
                        </label>
                    </div>

                    <!-- UCS命名规则设置 -->
                    <div id="ucsNamingOptions" class="settings-section">
                        <h3>命名元素选择</h3>
                        <p class="description">选择要包含的命名元素和排列顺序</p>

                        <div class="settings-columns">
                            <div class="settings-column">
                                <h4>分类信息</h4>
                                <div class="checkbox-group">
                                    <input type="checkbox" id="catID" checked>
                                    <label for="catID">分类ID (CatID)</label>
                                </div>
                                <div class="checkbox-group">
                                    <input type="checkbox" id="category">
                                    <label for="category">分类名称 (Category)</label>
                                </div>
                                <div class="checkbox-group">
                                    <input type="checkbox" id="category_zh" checked>
                                    <label for="category_zh">分类中文名 (Category_zh)</label>
                                </div>
                                <div class="checkbox-group">
                                    <input type="checkbox" id="subCategory">
                                    <label for="subCategory">子分类 (SubCategory)</label>
                                </div>
                                <div class="checkbox-group">
                                    <input type="checkbox" id="subCategory_zh">
                                    <label for="subCategory_zh">子分类中文名 (SubCategory_zh)</label>
                                </div>
                            </div>

                            <div class="settings-column">
                                <h4>描述信息</h4>
                                <div class="checkbox-group">
                                    <input type="checkbox" id="fxName" checked>
                                    <label for="fxName">英文描述 (FXName)</label>
                                </div>
                                <div class="checkbox-group">
                                    <input type="checkbox" id="fxName_zh" checked>
                                    <label for="fxName_zh">中文描述 (FXName_zh)</label>
                                </div>
                            </div>

                            <div class="settings-column">
                                <h4>元数据</h4>
                                <div class="checkbox-group">
                                    <input type="checkbox" id="creatorID">
                                    <label for="creatorID">制作者ID (CreatorID)</label>
                                </div>
                                <div class="checkbox-group">
                                    <input type="checkbox" id="sourceID">
                                    <label for="sourceID">项目ID (SourceID)</label>
                                </div>
                                <div class="checkbox-group">
                                    <input type="checkbox" id="serialNumber">
                                    <label for="serialNumber">三位数序号 (000)</label>
                                </div>
                            </div>
                        </div>

                        <div class="settings-group">
                            <div class="setting-item">
                                <label for="creatorIDValue"><i class="fas fa-user-edit"></i> 制作者ID：</label>
                                <input type="text" id="creatorIDValue" placeholder="例如: SFX" value="SFX">
                            </div>

                            <div class="setting-item">
                                <label for="sourceIDValue"><i class="fas fa-project-diagram"></i> 项目ID：</label>
                                <input type="text" id="sourceIDValue" placeholder="例如: UCS" value="UCS">
                            </div>

                            <div class="setting-item">
                                <label for="ucsSeparator"><i class="fas fa-minus"></i> 分隔符：</label>
                                <select id="ucsSeparator">
                                    <option value="_">下划线 (_)</option>
                                    <option value="-">连字符 (-)</option>
                                    <option value=".">点 (.)</option>
                                    <option value=" ">空格 ( )</option>
                                </select>
                            </div>
                        </div>

                        <div class="preview-container">
                            <label><i class="fas fa-eye"></i> 命名预览：</label>
                            <div id="namingPreview" class="preview-box">CatID_Category_zh_FXName_FXName_zh</div>
                            <small>注意: CatID等值从文件名中提取或从英文名翻译</small>
                        </div>
                    </div>

                    <!-- 传统命名规则设置 -->
                    <div id="traditionalNamingOptions" class="settings-section" style="display:none;">
                        <div class="settings-group">
                            <div class="setting-item">
                                <label for="namingFormat"><i class="fas fa-list-ol"></i> 命名格式：</label>
                                <select id="namingFormat">
                                    <option value="category_name">分类_名称</option>
                                    <option value="name_only">仅名称</option>
                                    <option value="custom">自定义</option>
                                </select>
                            </div>
                            <div class="setting-item custom-format" style="display: none;">
                                <label for="customTemplate"><i class="fas fa-code"></i> 自定义模板：</label>
                                <input type="text" id="customTemplate" placeholder="{category}-{name}">
                            </div>
                            <div class="setting-item">
                                <label for="separator"><i class="fas fa-minus"></i> 分隔符：</label>
                                <input type="text" id="separator" value="_" maxlength="1">
                            </div>
                        </div>
                    </div>
                </section>

                <!-- 翻译预览区域 -->
                <section id="previewPanel" class="section">
                    <h2><i class="fas fa-eye"></i> 预览与处理</h2>

                    <div id="previewPlaceholder" class="placeholder-message">
                        <i class="fas fa-file-audio"></i>
                        <p>请先选择文件，然后点击"开始翻译"进行处理</p>
                    </div>

                    <table id="previewTable" class="preview-table" style="display: none;">
                        <thead>
                            <tr>
                                <th width="5%"><input type="checkbox" id="selectAllPreviewFiles" checked></th>
                                <th width="13%">原文件名</th>
                                <th width="8%">CatID</th>
                                <th width="8%">替代匹配</th>
                                <th width="14%">英文描述(FXName)</th>
                                <th width="14%">中文描述(FXName_zh)</th>
                                <th width="28%">最终文件名</th>
                                <th width="10%">状态</th>
                            </tr>
                        </thead>
                        <tbody id="previewTableBody">
                            <!-- 文件预览行将在这里动态添加 -->
                        </tbody>
                    </table>

                    <div class="action-buttons">
                        <button id="startTranslationBtn" class="btn btn-primary">
                            <i class="fas fa-language"></i> 开始翻译
                        </button>
                        <button id="applyNamesBtn" class="btn btn-success" disabled>
                            <i class="fas fa-check"></i> 应用文件名
                        </button>
                        <button id="backToFilesBtn" class="btn btn-outline-secondary">
                            <i class="fas fa-arrow-left"></i> 返回
                        </button>
                    </div>
                </section>
            </div>
        </main>

        <footer class="app-footer">
            <p>音效文件名翻译重命名插件 v1.0.0</p>
        </footer>

        <!-- 状态提示 -->
        <div id="statusMessage" class="status-message"></div>

        <!-- 提示词预览对话框 -->
        <div id="promptPreviewModal" class="modal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>当前提示词内容</h3>
                    <span class="close">&times;</span>
                </div>
                <div class="modal-body">
                    <div class="prompt-section">
                        <h4>翻译提示词</h4>
                        <pre id="translationPromptPreview" class="prompt-preview"></pre>
                    </div>
                    <div class="prompt-section">
                        <h4>标准化提示词</h4>
                        <pre id="standardizePromptPreview" class="prompt-preview"></pre>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 错误处理脚本 -->
    <script>
        // 全局错误处理
        window.onerror = function(message, source, lineno, colno, error) {
            console.error('JavaScript错误:', message, '\n文件:', source, '\n行号:', lineno, '\n列号:', colno);

            // 在页面上显示错误信息
            const errorDiv = document.createElement('div');
            errorDiv.style.position = 'fixed';
            errorDiv.style.top = '10px';
            errorDiv.style.left = '10px';
            errorDiv.style.right = '10px';
            errorDiv.style.padding = '10px';
            errorDiv.style.backgroundColor = '#f8d7da';
            errorDiv.style.color = '#721c24';
            errorDiv.style.borderRadius = '4px';
            errorDiv.style.zIndex = '9999';
            errorDiv.style.boxShadow = '0 2px 10px rgba(0,0,0,0.2)';
            errorDiv.style.maxHeight = '80vh';
            errorDiv.style.overflow = 'auto';

            errorDiv.innerHTML = `
                <h3 style="margin-top:0">插件加载错误</h3>
                <p><strong>错误信息:</strong> ${message}</p>
                <p><strong>文件:</strong> ${source}</p>
                <p><strong>位置:</strong> 行 ${lineno}, 列 ${colno}</p>
                <p><strong>堆栈信息:</strong> ${error && error.stack ? error.stack.replace(/\n/g, '<br>') : '无堆栈信息'}</p>
                <button style="padding:5px 10px;margin-top:10px;background:#dc3545;color:white;border:none;border-radius:4px;cursor:pointer" onclick="this.parentNode.style.display='none'">关闭</button>
            `;

            document.body.appendChild(errorDiv);

            return true; // 防止默认错误处理
        };

        // 捕获Promise错误
        window.addEventListener('unhandledrejection', function(event) {
            console.error('Unhandled Promise rejection:', event.reason);
        });
    </script>

    <!-- 加载脚本 -->
    <!-- 工具类 -->
    <script src="./assets/js/utils/logger.js"></script>
    <script src="./assets/js/utils/cache.js"></script>
    <script src="./assets/js/utils/validator.js"></script>
    <script src="./assets/js/utils/number-extractor.js"></script>
    <script src="./assets/js/utils/naming-utils.js"></script>
    <script src="./assets/js/utils/matching-strategy-config.js"></script>

    <!-- 核心功能 -->
    <script src="./assets/js/core/translation/provider-interface.js"></script>
    <script src="./assets/js/core/translation/prompt-templates.js"></script>
    <script src="./assets/js/core/translation/providers/google-provider.js"></script>
    <script src="./assets/js/core/translation/providers/openrouter-provider.js"></script>
    <script src="./assets/js/core/translation/providers/zhipu-provider.js"></script>
    <script src="./assets/js/core/translation/providers/deepseek-provider.js"></script>
    <script src="./assets/js/core/translation/providers/bailian-provider.js"></script>
    <script src="./assets/js/core/translation/translation-service.js"></script>
    <script src="./assets/js/core/ai-classifier.js"></script>

    <!-- 匹配器 -->
    <script src="./assets/js/libs/papaparse.min.js"></script>
    <script src="./assets/js/libs/fuse.min.js"></script>
    <script src="./assets/js/core/csv-matcher.js"></script>
    <script src="./assets/js/core/fuse-matcher.js"></script>
    <script src="./assets/js/core/smart-classifier.js"></script>
    <script src="./assets/js/core/file-processor.js"></script>
    <script src="./assets/js/core/naming-rules.js"></script>



    <!-- UI组件 -->
    <script src="./assets/js/ui/folder-tree-selector.js"></script>
    <script src="./assets/js/ui/file-selector.js"></script>
    <script src="./assets/js/ui/translation-panel.js"></script>
    <script src="./assets/js/ui/preview-panel.js"></script>
    <script src="./assets/js/ui/matching-strategy-panel.js"></script>

    <!-- 主脚本 -->
    <script src="./assets/js/plugin.js"></script>
    <script src="./assets/js/main.js"></script>
</body>
</html>